From 0e89f357b1b0bcee94568f7b221972ef3a7ba7b3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
Date: Wed, 15 Dec 2021 14:58:49 +0000
Subject: [PATCH] unset mpMenuBarWidget when it was destroyed along with its
 parent

Resolves: https://github.com/flathub/org.libreoffice.LibreOffice/issues/173
Change-Id: I875cf658fb86adfa389429ead059bfd7c4f08ef4
Reviewed-on: https://gerrit.libreoffice.org/c/core/+/126887
Tested-by: Jenkins
Reviewed-by: Stephan Bergmann <sbergman@redhat.com>
---
 vcl/unx/gtk3/gtksalmenu.cxx | 1 +
 1 file changed, 1 insertion(+)

diff --git a/vcl/unx/gtk3/gtksalmenu.cxx b/vcl/unx/gtk3/gtksalmenu.cxx
index e9e6508ef407..1ae30b05a5b8 100644
--- a/vcl/unx/gtk3/gtksalmenu.cxx
+++ b/vcl/unx/gtk3/gtksalmenu.cxx
@@ -1114,6 +1114,7 @@ void GtkSalMenu::DestroyMenuBarWidget()
         g_clear_pointer(&mpMenuBarContainerWidget, gtk_widget_unparent);
 #endif
         mpMenuBarContainerWidget = nullptr;
+        mpMenuBarWidget = nullptr;
         mpCloseButton = nullptr;
     }
 }
-- 
2.33.1

